# GitLab 기반 전체 아키텍처

## 📊 시스템 구성도

```
┌─────────────────────────────────────────────────────────┐
│         Internet                                        │
│         (158.180.76.251)                                │
└───────────────┬──────────────────────────────────────────┘
                │
                │ (포트: 80, 443, 3000, 8080, 9000, 2222, 3030, 9090, 3100)
                ▼
┌─────────────────────────────────────────────────────────┐
│    Oracle Cloud Security Group                          │
│    - HTTP (80)                                          │
│    - HTTPS (443)                                        │
│    - Custom (3000) - NAS Frontend                       │
│    - Custom (3030) - Grafana                           │
│    - Custom (8080) - GitLab                             │
│    - Custom (9000) - Portainer                         │
│    - Custom (9090) - Prometheus                        │
│    - Custom (3100) - Loki                              │
│    - Custom (2222) - GitLab SSH                        │
│    - SSH (22)                                           │
└───────────────┬──────────────────────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────────────────────┐
│         Oracle Cloud Instance                           │
│         (Ubuntu 22.04 ARM64)                            │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Management Layer                                │  │
│  │                                                  │  │
│  │  ┌──────────────┐  ┌──────────────┐            │  │
│  │  │  GitLab      │  │  Portainer   │            │  │
│  │  │  (8080)      │  │  (9000)      │            │  │
│  │  │  - 코드 저장소│  │  - Docker    │            │  │
│  │  │  - CI/CD     │  │    관리      │            │  │
│  │  │  - 이슈 관리 │  │  - 컨테이너  │            │  │
│  │  │  - MR/PR     │  │    모니터링  │            │  │
│  │  │  - Wiki      │  │              │            │  │
│  │  └──────┬───────┘  └──────────────┘            │  │
│  │         │                                         │  │
│  │  ┌──────▼──────────┐                            │  │
│  │  │  GitLab Runner  │                            │  │
│  │  │  - CI/CD 실행   │                            │  │
│  │  │  - Docker 빌드  │                            │  │
│  │  │  - 배포 실행    │                            │  │
│  │  └─────────────────┘                            │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Monitoring Layer                                 │  │
│  │                                                  │  │
│  │  ┌──────────────┐  ┌──────────────┐            │  │
│  │  │  Grafana     │  │  Prometheus  │            │  │
│  │  │  (3030)      │  │  (9090)      │            │  │
│  │  │  - 시각화    │  │  - 메트릭    │            │  │
│  │  │  - 대시보드  │  │    수집      │            │  │
│  │  │  - 알림      │  │  - 저장      │            │  │
│  │  └──────┬───────┘  └──────┬───────┘            │  │
│  │         │                  │                     │  │
│  │  ┌──────▼──────────┐  ┌───────▼──────┐        │  │
│  │  │  Loki           │  │  Promtail     │        │  │
│  │  │  (3100)         │  │  - 로그 수집  │        │  │
│  │  │  - 로그 저장    │  │    에이전트   │        │  │
│  │  │  - 검색         │  │              │        │  │
│  │  └─────────────────┘  └──────────────┘        │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Docker Engine                                    │  │
│  │                                                   │  │
│  │  ┌─────────────────────────────────────────────┐ │  │
│  │  │  NAS Application Stack                      │ │  │
│  │  │  (Docker Compose)                           │ │  │
│  │  │                                              │ │  │
│  │  │  ┌──────────────┐                           │ │  │
│  │  │  │  Frontend    │                           │ │  │
│  │  │  │  (Vue.js)    │                           │ │  │
│  │  │  │  Port: 3000  │                           │ │  │
│  │  │  │  - nginx     │                           │ │  │
│  │  │  │  - API 프록시│                           │ │  │
│  │  │  └──────┬───────┘                           │ │  │
│  │  │         │                                    │ │  │
│  │  │         ├─────────────────┐                 │ │  │
│  │  │         │                 │                 │ │  │
│  │  │  ┌──────▼───────┐  ┌───────▼──────┐      │ │  │
│  │  │  │  Spring Boot │  │  Kotlin API  │      │ │  │
│  │  │  │  API         │  │  (Ktor)      │      │ │  │
│  │  │  │  Port: 8080  │  │  Port: 8081  │      │ │  │
│  │  │  │  (내부)       │  │  (내부)       │      │ │  │
│  │  │  └──────┬───────┘  └───────┬──────┘      │ │  │
│  │  │         │                  │                │ │  │
│  │  │         └─────────┬─────────┘                │ │  │
│  │  │                   │                          │ │  │
│  │  │         ┌─────────▼─────────┐                │ │  │
│  │  │         │  MySQL Database   │                │ │  │
│  │  │         │  Port: 3306       │                │ │  │
│  │  │         │  (내부)            │                │ │  │
│  │  │         │  Volume: mysql_data│                │ │  │
│  │  │         └───────────────────┘                │ │  │
│  │  └─────────────────────────────────────────────┘ │  │
│  └───────────────────────────────────────────────────┘  │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

## 🔄 CI/CD 워크플로우

```
1. 개발자 코드 푸시
   ↓
2. GitLab 저장소에 커밋
   ↓
3. GitLab CI/CD 파이프라인 자동 트리거
   ↓
4. Build Stage
   - Spring Boot 이미지 빌드
   - Kotlin 이미지 빌드
   - Vue.js 이미지 빌드
   ↓
5. Test Stage
   - Backend 단위 테스트
   - 통합 테스트 (Docker Compose)
   ↓
6. Deploy Stage (수동 실행)
   - Docker Compose로 배포
   - 헬스 체크 검증
   ↓
7. 배포 완료
```

## 🔧 구성 요소 상세

### 1. GitLab CE
- **역할**: 코드 저장소, CI/CD, 이슈 관리
- **접근**: `http://YOUR_SERVER_IP:8080`
- **SSH**: `ssh://git@YOUR_SERVER_IP:2222`
- **기능**:
  - Git 저장소 관리
  - CI/CD 파이프라인 실행
  - 이슈 및 Merge Request 관리
  - 코드 리뷰
  - Wiki 및 문서 관리

### 2. GitLab Runner
- **역할**: CI/CD 작업 실행
- **Executor**: Docker
- **기능**:
  - Docker 이미지 빌드
  - 테스트 실행
  - Docker Compose 배포
  - 로그 수집

### 3. Portainer
- **역할**: Docker 관리 도구
- **접근**: `http://YOUR_SERVER_IP:9000`
- **기능**:
  - 컨테이너 관리
  - Docker Compose 스택 관리
  - 로그 확인
  - 리소스 모니터링

### 4. NAS 애플리케이션 스택

#### Frontend (Vue.js)
- **컨테이너**: nas-frontend-vue
- **포트**: 3000 (외부 노출)
- **기능**: 정적 파일 서빙, API 프록시

#### Backend - Spring Boot
- **컨테이너**: nas-backend-springboot
- **포트**: 8080 (내부 네트워크)
- **기능**: REST API 서버

#### Backend - Kotlin (Ktor)
- **컨테이너**: nas-backend-kotlin
- **포트**: 8081 (내부 네트워크)
- **기능**: REST API 서버

#### Database - MySQL
- **컨테이너**: nas-mysql
- **포트**: 3306 (내부 네트워크)
- **볼륨**: mysql_data (데이터 영속성)

## 📊 접근 경로

### 사용자 접근
- **NAS Frontend**: `http://YOUR_SERVER_IP:3000`
- **API**: `http://YOUR_SERVER_IP:3000/api/*`

### 개발자 접근
- **GitLab**: `http://YOUR_SERVER_IP:8080`
- **GitLab SSH**: `ssh://git@YOUR_SERVER_IP:2222`
- **Portainer**: `http://YOUR_SERVER_IP:9000`

### 모니터링 접근
- **Grafana**: `http://YOUR_SERVER_IP:3030` (기본: admin/admin)
- **Prometheus**: `http://YOUR_SERVER_IP:9090`
- **Loki**: `http://YOUR_SERVER_IP:3100`

## 🔐 보안 계층

1. **네트워크 레벨**
   - Oracle Cloud Security Group
   - 방화벽 규칙
   - 포트 제한

2. **GitLab 레벨**
   - 사용자 인증
   - 프로젝트 접근 권한
   - CI/CD 변수 암호화

3. **애플리케이션 레벨**
   - Secret 관리
   - 환경 변수 분리
   - 내부 네트워크 격리

## 📈 확장성

### 수평 확장
- GitLab Runner 추가 가능
- Docker Compose 서비스 replicas 증가

### 수직 확장
- 인스턴스 리소스 증가
- GitLab 리소스 제한 조정

## 💰 리소스 요구사항

### 최소 구성
- **CPU**: 4 코어
- **RAM**: 6GB
- **디스크**: 50GB

### 권장 구성
- **CPU**: 4-8 코어
- **RAM**: 8GB
- **디스크**: 100GB

### 리소스 분배
- **GitLab**: ~4GB RAM
- **GitLab Runner**: ~500MB RAM
- **Portainer**: ~200MB RAM
- **NAS 서비스**: ~1GB RAM
- **여유 공간**: ~1GB RAM

## 🚀 배포 프로세스

1. **코드 푸시** → GitLab 저장소
2. **CI/CD 트리거** → 파이프라인 시작
3. **빌드 단계** → Docker 이미지 빌드
4. **테스트 단계** → 통합 테스트 실행
5. **배포 단계** → Docker Compose로 배포 (수동 실행)
6. **헬스 체크** → 서비스 상태 확인

## 📚 관리 도구 비교

| 도구 | 용도 | 접근 방식 | 특징 |
|------|------|-----------|------|
| GitLab | 코드 저장소, CI/CD | 웹 UI | 가장 강력, 통합 관리 |
| Portainer | Docker 관리 | 웹 UI | 컨테이너 모니터링 |
| GitLab Runner | CI/CD 실행 | 자동 | 파이프라인 실행 |

---

**작성일**: 2024년
**대상 환경**: Oracle Cloud Infrastructure
**GitLab**: GitLab CE Latest
**Runner**: GitLab Runner Latest

