# MongoDB & Elasticsearch 추가 시 성능 분석

## 📊 현재 시스템 구성

### 현재 실행 중인 서비스
1. **MySQL 8.4** - 관계형 데이터베이스
2. **Spring Boot Backend** (Java 25) - API 서버
3. **Kotlin Backend** (Java 25) - API 서버
4. **Vue.js Frontend** (Node.js 24.13.0) - 프론트엔드
5. **Portainer** - Docker 관리
6. **Netdata** - 실시간 모니터링

### 현재 리소스 사용량 추정

| 서비스 | RAM (예상) | CPU (예상) | 디스크 |
|--------|-----------|-----------|--------|
| MySQL 8.4 | 500MB - 1GB | 0.5-1 코어 | 5-10GB |
| Spring Boot | 300-500MB | 0.5 코어 | 1GB |
| Kotlin Backend | 300-500MB | 0.5 코어 | 1GB |
| Vue.js Frontend | 200-300MB | 0.3 코어 | 500MB |
| Portainer | 100-200MB | 0.2 코어 | 100MB |
| Netdata | 200-400MB | 0.3-0.5 코어 | 1-2GB |
| **현재 총합** | **2.2-3.9GB** | **3.0-3.9 코어** | **18-35GB** |

---

## 🔴 MongoDB 추가 시 리소스 요구사항

### MongoDB 최소 요구사항
- **RAM**: 최소 1GB, 권장 2-4GB
- **CPU**: 최소 1 코어, 권장 2 코어
- **디스크**: 최소 10GB, 권장 20-50GB (데이터량에 따라)

### MongoDB 실제 사용량 (소규모 프로젝트)
- **RAM**: 500MB - 2GB (기본 설정)
- **CPU**: 0.5-1 코어 (일반 작업)
- **디스크**: 10-20GB (인덱스 + 데이터)

### MongoDB 추가 후 예상 리소스

| 항목 | 현재 | MongoDB 추가 후 | 증가량 |
|------|------|----------------|--------|
| **RAM** | 2.0-3.5GB | 2.5-5.5GB | +500MB~2GB |
| **CPU** | 2.7-3.4 코어 | 3.2-4.4 코어 | +0.5~1 코어 |
| **디스크** | 17-33GB | 27-53GB | +10~20GB |

---

## 🔴 Elasticsearch 추가 시 리소스 요구사항

### Elasticsearch 최소 요구사항
- **RAM**: 최소 2GB, 권장 4-8GB
- **CPU**: 최소 2 코어, 권장 4 코어
- **디스크**: 최소 20GB, 권장 50-100GB (인덱스 + 샤드)

### Elasticsearch 실제 사용량 (소규모 프로젝트)
- **RAM**: 1-2GB (힙 메모리) + 500MB (시스템)
- **CPU**: 1-2 코어 (인덱싱/검색 작업)
- **디스크**: 20-50GB (인덱스 + 데이터)

### Elasticsearch 추가 후 예상 리소스

| 항목 | 현재 | Elasticsearch 추가 후 | 증가량 |
|------|------|---------------------|--------|
| **RAM** | 2.0-3.5GB | 3.0-5.5GB | +1~2GB |
| **CPU** | 2.7-3.4 코어 | 3.7-5.4 코어 | +1~2 코어 |
| **디스크** | 17-33GB | 37-83GB | +20~50GB |

---

## ⚠️ MongoDB + Elasticsearch 동시 추가 시

### 총 리소스 요구사항

| 항목 | 현재 | MongoDB + ES 추가 후 | 증가량 |
|------|------|---------------------|--------|
| **RAM** | 2.0-3.5GB | **4.0-7.5GB** | **+2~4GB** |
| **CPU** | 2.7-3.4 코어 | **4.7-6.4 코어** | **+2~3 코어** |
| **디스크** | 17-33GB | **47-103GB** | **+30~70GB** |

### 최소 시스템 요구사항 (MongoDB + ES 포함)
- **RAM**: 최소 8GB (권장 16GB) - ✅ 현재 24GB 충분
- **CPU**: 최소 6 코어 (권장 8 코어) - ⚠️ 현재 4 코어 부족 가능
- **디스크**: 최소 100GB (권장 200GB) - ❌ 현재 47GB 부족

---

## 📈 성능 영향 분석

### 1. 메모리 (RAM) 영향

#### 현재 상태 (GitLab 제거 후)
- GitLab이 제거되어 약 **4GB RAM 절약**
- 현재 사용량: 약 2-3.5GB
- 여유 공간: 약 4.5-6GB (8GB 시스템 기준)

#### MongoDB + ES 추가 시
- **메모리 사용량**: 4-7.5GB
- **24GB 시스템 (현재)**: 여유 공간 16.5-20GB (✅ 매우 여유)
- **RAM은 충분하나 CPU와 디스크가 제약 요소**

#### 메모리 부족 시 증상
- 스왑 메모리 사용 증가 → 성능 저하
- OOM (Out of Memory) 에러 발생 가능
- 서비스 응답 지연

### 2. CPU 영향

#### 현재 상태
- CPU 사용률: 약 30-40% (2.7-3.4 코어 / 8 코어 기준)
- 여유 CPU: 약 60-70%

#### MongoDB + ES 추가 시
- CPU 사용률: 약 118-160% (4.7-6.4 코어 / 4 코어 기준) ❌
- 여유 CPU: -18~-60% (부족)
- **현재 4 코어 시스템에서는 CPU 부족 예상**

#### CPU 부족 시 증상
- 인덱싱/검색 작업 시 응답 지연
- 동시 요청 처리 능력 저하
- 백엔드 API 응답 시간 증가

### 3. 디스크 I/O 영향

#### 현재 상태
- 디스크 사용량: 17-33GB
- I/O 부하: 낮음-중간

#### MongoDB + ES 추가 시
- 디스크 사용량: 47-103GB
- **현재 디스크 용량: 47GB** ❌
- **디스크 부족으로 운영 불가능**
- I/O 부하: 중간-높음 (인덱싱, 검색 작업)

#### 디스크 부족 시 증상
- 인덱스 생성 실패
- 데이터 쓰기 성능 저하
- 로그 수집 중단 가능

---

## 🎯 권장사항

### 시나리오 1: MongoDB만 추가 (권장) ⭐⭐⭐⭐

**리소스 요구사항:**
- RAM: 2.5-5.5GB (현재 24GB 중 사용)
- CPU: 3.2-4.4 코어 (현재 4 코어 중 사용) ⚠️
- 디스크: 27-53GB (현재 47GB 중 사용) ⚠️

**장점:**
- ✅ RAM 24GB로 충분 (18.5-21.5GB 여유)
- ✅ GitLab 제거로 확보한 리소스 활용
- ✅ NoSQL 데이터 저장소 추가

**주의사항:**
- ⚠️ CPU 4 코어로는 약간 부족할 수 있음 (리소스 제한 권장)
- ⚠️ 디스크 47GB는 최소한의 여유만 있음 (모니터링 필수)

**단점:**
- ⚠️ 검색 기능은 제한적 (기본 인덱스만)

**적합한 경우:**
- 문서 기반 데이터 저장 필요
- 유연한 스키마 필요
- 검색 기능은 기본 수준으로 충분

---

### 시나리오 2: Elasticsearch만 추가 ⚠️

**리소스 요구사항:**
- RAM: 3.0-5.5GB (현재 24GB 중 사용) ✅
- CPU: 3.7-5.4 코어 (현재 4 코어 중 사용) ❌
- 디스크: 37-83GB (현재 47GB 중 사용) ❌

**장점:**
- ✅ 강력한 검색 기능
- ✅ 실시간 검색 및 분석
- ✅ 로그 분석에 유용

**단점:**
- ❌ CPU 부족 (4 코어 < 3.7-5.4 코어 필요)
- ❌ 디스크 부족 (47GB < 37-83GB 필요)
- ⚠️ 설정 및 관리 복잡도 높음

**적합한 경우:**
- 강력한 검색 기능 필요
- 로그 분석 및 검색 필요
- 실시간 데이터 분석 필요

---

### 시나리오 3: MongoDB + Elasticsearch 동시 추가 ❌

**리소스 요구사항:**
- RAM: 4.0-7.5GB (현재 24GB 중 사용) ✅ 충분
- CPU: 4.7-6.4 코어 (현재 4 코어 중 사용) ❌ 부족
- 디스크: 47-103GB (현재 47GB 중 사용) ❌ 부족

**장점:**
- ✅ NoSQL + 검색 엔진 완벽 조합
- ✅ 다양한 데이터 저장 및 검색 옵션

**단점:**
- ❌ 리소스 사용량 매우 높음
- ❌ 8GB RAM 시스템에서는 부족
- ❌ 관리 복잡도 증가

**현재 시스템에서는 불가능:**
- ❌ CPU 부족 (4 코어 < 4.7-6.4 코어)
- ❌ 디스크 부족 (47GB < 47-103GB)
- ⚠️ 디스크 최소 100GB 이상 필요
- ⚠️ CPU 최소 6 코어 이상 권장

---

## 💡 최적화 방안

### 1. 리소스 제한 설정

#### MongoDB 최적화
```yaml
mongodb:
  deploy:
    resources:
      limits:
        memory: 2G
        cpus: '1.0'
      reservations:
        memory: 1G
        cpus: '0.5'
  environment:
    - MONGO_INITDB_ROOT_USERNAME=admin
    - MONGO_INITDB_ROOT_PASSWORD=${MONGO_PASSWORD}
```

#### Elasticsearch 최적화
```yaml
elasticsearch:
  deploy:
    resources:
      limits:
        memory: 2G
        cpus: '2.0'
      reservations:
        memory: 1G
        cpus: '1.0'
  environment:
    - "ES_JAVA_OPTS=-Xms1g -Xmx1g"  # 힙 메모리 제한
    - discovery.type=single-node
```

### 2. 단계적 도입

1. **1단계**: MongoDB만 추가 → 리소스 모니터링
2. **2단계**: 필요 시 Elasticsearch 추가
3. **3단계**: 리소스 부족 시 인스턴스 업그레이드

### 3. 모니터링 강화

- Netdata로 리소스 모니터링
- 메모리/CPU 사용률 알림 설정
- 디스크 사용량 정기 확인

---

## 📊 결론

### 실제 시스템 사양
- **OCPU**: 4 코어
- **RAM**: 24GB
- **디스크**: 47GB

### 리소스 사용량 분석 (실제 시스템 기준)

| 구성 | RAM 사용 | RAM 여유 | CPU 사용 | CPU 여유 | 디스크 사용 | 디스크 여유 | 평가 |
|------|---------|---------|---------|---------|------------|------------|------|
| **현재 (GitLab 제거 후)** | 2-3.5GB | **20.5-22GB** | 2.7-3.4 코어 | **0.6-1.3 코어** | 17-33GB | **14-30GB** | ✅ 매우 여유 |
| **+ MongoDB** | 2.5-5.5GB | **18.5-21.5GB** | 3.2-4.4 코어 | **-0.4~0.8 코어** | 27-53GB | **-6~20GB** | ⚠️ 디스크 주의 |
| **+ Elasticsearch** | 3.0-5.5GB | **18.5-21GB** | 3.7-5.4 코어 | **-1.4~0.3 코어** | 37-83GB | **-36~10GB** | ❌ 디스크 부족 |
| **+ MongoDB + ES** | 4.0-7.5GB | **16.5-20GB** | 4.7-6.4 코어 | **-2.4~-0.7 코어** | 47-103GB | **-56~0GB** | ❌ 디스크/CPU 부족 |

### 상세 분석

#### 1. 메모리 (RAM) - ✅ 매우 여유
- **현재 사용**: 2-3.5GB / 24GB (약 8-15%)
- **MongoDB + ES 추가 후**: 4-7.5GB / 24GB (약 17-31%)
- **여유 공간**: 16.5-20GB (약 69-83%)
- **결론**: RAM은 충분하며 MongoDB + Elasticsearch 모두 추가 가능

#### 2. CPU (OCPU) - ⚠️ 주의 필요
- **현재 사용**: 2.7-3.4 코어 / 4 코어 (약 68-85%)
- **MongoDB + ES 추가 후**: 4.7-6.4 코어 / 4 코어 (약 118-160%)
- **문제점**: CPU가 부족할 수 있음 (4 코어 < 4.7-6.4 코어 필요)
- **결론**: CPU가 병목이 될 가능성 높음

#### 3. 디스크 (47GB) - ❌ 매우 제한적
- **현재 사용**: 17-33GB / 47GB (약 36-70%)
- **MongoDB + ES 추가 후**: 47-103GB / 47GB (약 100-219%)
- **문제점**: 디스크 용량 부족 (47GB < 47-103GB 필요)
- **결론**: 디스크 용량이 가장 큰 제약 요소

### 최종 권장사항 (실제 시스템 기준)

#### ✅ 권장: MongoDB만 추가
- **RAM**: 2.5-5.5GB 사용 (18.5-21.5GB 여유) ✅
- **CPU**: 3.2-4.4 코어 사용 (0~0.8 코어 여유) ⚠️
- **디스크**: 27-53GB 사용 (0~20GB 여유) ⚠️
- **평가**: 가능하나 디스크 모니터링 필요

#### ⚠️ 주의: Elasticsearch 추가
- **RAM**: 3.0-5.5GB 사용 (18.5-21GB 여유) ✅
- **CPU**: 3.7-5.4 코어 사용 (-1.4~0.3 코어 여유) ❌
- **디스크**: 37-83GB 사용 (-36~10GB 여유) ❌
- **평가**: 디스크 부족 및 CPU 부하 높음

#### ❌ 비권장: MongoDB + Elasticsearch 동시 추가
- **RAM**: 4.0-7.5GB 사용 (16.5-20GB 여유) ✅
- **CPU**: 4.7-6.4 코어 사용 (-2.4~-0.7 코어 여유) ❌
- **디스크**: 47-103GB 사용 (-56~0GB 여유) ❌
- **평가**: 디스크 및 CPU 부족으로 운영 불가능

### 구체적 권장사항

1. **MongoDB만 추가** (권장) ⭐⭐⭐⭐
   - RAM: 충분 ✅
   - CPU: 주의 필요 ⚠️ (리소스 제한 설정 권장)
   - 디스크: 모니터링 필요 ⚠️ (데이터 정리 정책 필요)

2. **디스크 확장 필요**
   - 현재 47GB는 부족
   - 최소 100GB 이상 권장
   - MongoDB만 추가해도 27-53GB 사용 예상

3. **CPU 최적화**
   - MongoDB 리소스 제한 설정 (CPU 0.5-1 코어)
   - Elasticsearch 추가 시 CPU 부족 예상

4. **단계적 도입**
   - 1단계: 디스크 확장 (47GB → 100GB+)
   - 2단계: MongoDB 추가 및 모니터링
   - 3단계: 필요 시 Elasticsearch 추가 (디스크 확장 필수)

---

**작성일**: 2026-01-26
**분석 기준**: Oracle Cloud Infrastructure
- **OCPU**: 4 코어
- **RAM**: 24GB
- **디스크**: 47GB
