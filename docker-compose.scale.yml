version: '3.8'

# 스케일링 및 롤링 배포를 위한 Docker Compose 오버라이드
# 사용법: docker-compose -f docker-compose.yml -f docker-compose.scale.yml up -d

services:
  # Spring Boot Backend - 2개 인스턴스
  backend-springboot:
    deploy:
      replicas: 2
    # 포트는 내부 네트워크만 사용 (Nginx를 통해 접근)
    # ports:
    #   - "${SPRINGBOOT_PORT:-8080}:8080"
    environment:
      # Stateless 구성 (세션 공유 불필요)
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-dev}

  # Kotlin Backend - 2개 인스턴스
  backend-kotlin:
    deploy:
      replicas: 2
    # 포트는 내부 네트워크만 사용 (Nginx를 통해 접근)
    # ports:
    #   - "${KOTLIN_PORT:-8081}:8081"
    environment:
      # Stateless 구성

  # 참고: 별도의 Nginx 컨테이너는 불필요
  # Frontend의 Nginx에서 Backend 로드 밸런싱 처리
  # Frontend 컨테이너 내부의 Nginx 설정만 수정하면 됨

  # Frontend - 2개 인스턴스 (선택사항)
  # frontend-vue:
  #   deploy:
  #     replicas: 2
  #   # Nginx를 사용하는 경우 포트는 내부 네트워크만 사용
  #   # ports:
  #   #   - "${VUE_PORT:-3000}:3000"

