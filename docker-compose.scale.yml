version: '3.8'

# 스케일링 및 롤링 배포를 위한 Docker Compose 오버라이드
# 사용법: docker-compose -f docker-compose.yml -f docker-compose.scale.yml up -d

services:
  # Spring Boot Backend - 2개 인스턴스
  backend-springboot:
    deploy:
      replicas: 2
    # 포트는 내부 네트워크만 사용 (Nginx를 통해 접근)
    # ports:
    #   - "${SPRINGBOOT_PORT:-8080}:8080"
    environment:
      # Stateless 구성 (세션 공유 불필요)
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-dev}

  # Kotlin Backend - 2개 인스턴스
  backend-kotlin:
    deploy:
      replicas: 2
    # 포트는 내부 네트워크만 사용 (Nginx를 통해 접근)
    # ports:
    #   - "${KOTLIN_PORT:-8081}:8081"
    environment:
      # Stateless 구성

  # Nginx - 로드 밸런서 (선택사항)
  # Frontend 2개를 사용하지 않는 경우 주석 처리
  # nginx:
  #   image: nginx:alpine
  #   container_name: nas-nginx
  #   restart: unless-stopped
  #   ports:
  #     - "3000:80"
  #   volumes:
  #     - ./nginx/nginx.conf:/etc/nginx/nginx.conf
  #   networks:
  #     - nas-network
  #   depends_on:
  #     - backend-springboot
  #     - backend-kotlin
  #     - frontend-vue

  # Frontend - 2개 인스턴스 (선택사항)
  # frontend-vue:
  #   deploy:
  #     replicas: 2
  #   # Nginx를 사용하는 경우 포트는 내부 네트워크만 사용
  #   # ports:
  #   #   - "${VUE_PORT:-3000}:3000"

