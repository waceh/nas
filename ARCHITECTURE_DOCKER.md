# Docker Compose 기반 전체 아키텍처

## 📊 Portainer 포함 아키텍처

```
┌─────────────────────────────────────────────────────────┐
│         Internet                                        │
│         (158.180.76.251)                                │
└───────────────┬──────────────────────────────────────────┘
                │
                │ (포트: 80, 443, 3000, 3030, 9000, 9090, 3100, 9443)
                ▼
┌─────────────────────────────────────────────────────────┐
│    Oracle Cloud Security Group                          │
│    - HTTP (80)                                          │
│    - HTTPS (443)                                        │
│    - Custom (3000) - NAS Frontend                       │
│    - Custom (3030) - Grafana                           │
│    - Custom (9000) - Portainer HTTP                     │
│    - Custom (9090) - Prometheus                        │
│    - Custom (3100) - Loki                              │
│    - Custom (9443) - Portainer HTTPS                    │
│    - SSH (22)                                           │
└───────────────┬──────────────────────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────────────────────┐
│         Oracle Cloud Instance                           │
│         (Ubuntu 22.04 ARM64)                            │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Management Layer                                │  │
│  │                                                  │  │
│  │  ┌────────────────────────────────────────────┐ │  │
│  │  │  Portainer                                 │ │  │
│  │  │  - Docker 컨테이너 관리                    │ │  │
│  │  │  - Docker Compose 스택 관리                 │ │  │
│  │  │  - 컨테이너 모니터링                        │ │  │
│  │  │  - 로그 뷰어                                │ │  │
│  │  │  - 볼륨/네트워크 관리                       │ │  │
│  │  │  - 이미지 관리                              │ │  │
│  │  │  Port: 9000 (HTTP), 9443 (HTTPS)           │ │  │
│  │  └────────────────────────────────────────────┘ │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Monitoring Layer                                 │  │
│  │                                                  │  │
│  │  ┌──────────────┐  ┌──────────────┐            │  │
│  │  │  Grafana     │  │  Prometheus  │            │  │
│  │  │  (3030)      │  │  (9090)      │            │  │
│  │  │  - 시각화    │  │  - 메트릭    │            │  │
│  │  │  - 대시보드  │  │    수집      │            │  │
│  │  │  - 알림      │  │  - 저장      │            │  │
│  │  └──────┬───────┘  └──────┬───────┘            │  │
│  │         │                  │                     │  │
│  │  ┌──────▼──────────┐  ┌───────▼──────┐        │  │
│  │  │  Loki           │  │  Promtail     │        │  │
│  │  │  (3100)         │  │  - 로그 수집  │        │  │
│  │  │  - 로그 저장    │  │    에이전트   │        │  │
│  │  │  - 검색         │  │              │        │  │
│  │  └─────────────────┘  └──────────────┘        │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Docker Engine                                    │  │
│  │                                                   │  │
│  │  ┌─────────────────────────────────────────────┐ │  │
│  │  │  NAS Application Stack                      │ │  │
│  │  │  (Docker Compose)                           │ │  │
│  │  │                                              │ │  │
│  │  │  ┌──────────────┐                           │ │  │
│  │  │  │  Frontend    │                           │ │  │
│  │  │  │  (Vue.js)    │                           │ │  │
│  │  │  │  Port: 3000  │                           │ │  │
│  │  │  │  - nginx     │                           │ │  │
│  │  │  │  - API 프록시│                           │ │  │
│  │  │  └──────┬───────┘                           │ │  │
│  │  │         │                                    │ │  │
│  │  │         ├─────────────────┐                 │ │  │
│  │  │         │                 │                 │ │  │
│  │  │  ┌──────▼───────┐  ┌───────▼──────┐      │ │  │
│  │  │  │  Spring Boot │  │  Kotlin API  │      │ │  │
│  │  │  │  API         │  │  (Ktor)      │      │ │  │
│  │  │  │  Port: 8080  │  │  Port: 8081  │      │ │  │
│  │  │  │  (내부)       │  │  (내부)       │      │ │  │
│  │  │  └──────┬───────┘  └───────┬──────┘      │ │  │
│  │  │         │                  │                │ │  │
│  │  │         └─────────┬─────────┘                │ │  │
│  │  │                   │                          │ │  │
│  │  │         ┌─────────▼─────────┐                │ │  │
│  │  │         │  MySQL Database   │                │ │  │
│  │  │         │  Port: 3306       │                │ │  │
│  │  │         │  (내부)            │                │ │  │
│  │  │         │  Volume: mysql_data│                │ │  │
│  │  │         └───────────────────┘                │ │  │
│  │  └─────────────────────────────────────────────┘ │  │
│  └───────────────────────────────────────────────────┘  │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

## 🔧 구성 요소 상세

### 1. Portainer (관리 도구)
- **역할**: Docker 및 Docker Compose 관리
- **접근**: `http://YOUR_SERVER_IP:9000`
- **기능**:
  - 컨테이너 관리 (시작/중지/재시작/삭제)
  - Docker Compose 스택 관리
  - 로그 실시간 확인
  - 리소스 모니터링
  - 볼륨 및 네트워크 관리
  - 이미지 관리
  - 사용자 권한 관리

### 6. NAS 애플리케이션 스택

#### Frontend (Vue.js)
- **컨테이너**: nas-frontend-vue
- **포트**: 3000 (외부 노출)
- **기능**: 정적 파일 서빙, API 프록시

#### Backend - Spring Boot
- **컨테이너**: nas-backend-springboot
- **포트**: 8080 (내부 네트워크)
- **기능**: REST API 서버

#### Backend - Kotlin (Ktor)
- **컨테이너**: nas-backend-kotlin
- **포트**: 8081 (내부 네트워크)
- **기능**: REST API 서버

#### Database - MySQL
- **컨테이너**: nas-mysql
- **포트**: 3306 (내부 네트워크)
- **볼륨**: mysql_data (데이터 영속성)

## 📊 접근 경로

### 사용자 접근
- **NAS Frontend**: `http://YOUR_SERVER_IP:3000`
- **API**: `http://YOUR_SERVER_IP:3000/api/*`

### 관리자 접근
- **Portainer**: `http://YOUR_SERVER_IP:9000`
- **Portainer HTTPS**: `https://YOUR_SERVER_IP:9443`

## 🎛️ Portainer 주요 기능

### 1. 대시보드
- 전체 컨테이너 상태 한눈에 확인
- 리소스 사용량 모니터링
- 빠른 액션 버튼

### 2. 컨테이너 관리
- 컨테이너 목록 및 필터링
- 컨테이너 상세 정보
- 로그 실시간 스트리밍
- 컨테이너 실행/중지/재시작
- 컨테이너 설정 편집
- 컨테이너 삭제

### 3. 스택 관리 (Docker Compose)
- docker-compose.yml 업로드
- 스택 배포 및 업데이트
- 스택 상태 모니터링
- 환경 변수 관리
- 스택 삭제

### 4. 이미지 관리
- 이미지 목록 및 검색
- 이미지 상세 정보
- 이미지 빌드 (Dockerfile)
- 이미지 삭제
- 이미지 태그 관리

### 5. 볼륨 관리
- 볼륨 목록 및 사용량
- 볼륨 상세 정보
- 볼륨 생성/삭제
- 볼륨 백업

### 6. 네트워크 관리
- 네트워크 목록
- 네트워크 상세 정보
- 네트워크 생성/삭제
- 컨테이너 연결 관리

### 7. 이벤트 및 로그
- Docker 이벤트 실시간 확인
- 컨테이너 로그 검색 및 필터링
- 로그 다운로드

## 🔐 보안 설정

### Portainer 보안
1. **초기 설정**: 강력한 관리자 비밀번호
2. **HTTPS**: 포트 9443 사용 권장
3. **방화벽**: 특정 IP만 접근 허용
4. **사용자 관리**: 팀 및 권한 설정

### Oracle Cloud Security Group
- 포트 9000: Portainer HTTP
- 포트 9443: Portainer HTTPS
- 특정 IP만 허용하는 것을 권장

## 💰 리소스 사용량

### Portainer
- **RAM**: 약 100-200MB
- **CPU**: 최소
- **디스크**: 약 50MB

### 전체 시스템
- **기존 NAS 서비스**: 그대로 유지
- **추가 리소스**: Portainer만 추가 (약 200MB)

## 🚀 설치 및 사용

### 1. docker-compose.yml에 추가
Portainer 서비스가 이미 추가되어 있습니다.

### 2. 서비스 시작
```bash
docker-compose up -d portainer
```

### 3. Portainer 접속
```
http://YOUR_SERVER_IP:9000
```

### 4. 초기 설정
- 관리자 계정 생성
- "Docker" 환경 선택
- 로컬 Docker 소켓 연결

### 5. 스택 관리
- "Stacks" 메뉴에서 docker-compose.yml 관리
- 또는 기존 스택 모니터링

## 📈 모니터링 및 관리

### Portainer를 통한 관리
- 컨테이너 상태 실시간 확인
- 리소스 사용량 모니터링
- 로그 확인 및 검색
- 빠른 문제 해결

### 추가 모니터링 도구 (선택사항)
- **Grafana + Prometheus**: 메트릭 수집 및 시각화
- **cAdvisor**: 컨테이너 메트릭
- **Netdata**: 실시간 시스템 모니터링

---

**작성일**: 2024년
**대상 환경**: Docker Compose
**관리 도구**: Portainer

